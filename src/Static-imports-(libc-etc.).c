typedef struct
{
    union
    {
        struct
        {
            uint16_t size_short; // -8
            uint16_t pad;
        } uint32_t size; // -8
    };
    uint32_t unk1; // -4
    uint8_t data[]; // 0 Pointer which is actually returned
} Allocation;

//----- (0048D7E0) --------------------------------------------------------
// Allocate()
// allocator which grabs small allocations from malloc, and seems to use buckets
// or a heap for larger allocations
unsigned __int16 *__cdecl sub_48D7E0(unsigned int a1);

//----- (0048DB10) --------------------------------------------------------
// allocator which will be used when the alloction is small enough
void *__cdecl sub_48DB10(uint32_t a1)
{
    Allocation *result = malloc(8 + a1); // 8 = sizeof(Allocation)
    if (result == 0)
    {
        return 0;
    }
    result->size = a1 + 8;
    result->unk1 = 0;
    return result->data;
}

//----- (0048D9A0) --------------------------------------------------------
// Free()
// counterpart to 0048D7E0
void __cdecl sub_48D9A0(int a1);

//----- (0048DA80) --------------------------------------------------------
// Realloc()
// a1 = old pointer or 0
// a2 = new size
unsigned __int16 *__cdecl sub_48DA80(_DWORD *a1, unsigned int a2)
{
    unsigned __int16 *result; // eax
    unsigned int v3; // esi
    unsigned __int16 *v4; // ebp
    int v5; // eax
    unsigned int v6; // eax

    // If no allocation existed, create a new one.. done!
    if (a1 == 0)
    {
        return sub_48D7E0(a2);
    }

    // If the new size is zero, just free the block
    if (a2 == 0)
    {
        sub_48D9A0((int)a1);
        return 0;
    }

    // Create a new allocation where we can move to
    v4 = sub_48D7E0(a2);
    if (v4 == 0)
    {
        return 0;
    }

    // Lookup old allocation size
    Allocation *a = (uintptr_t)a1 - 8; // 8 = sizeof(Allocation)
    if (a->unk1) )
        {
            v5 = a->size_short
                & 0x7FFF; // FIXME: WTH?! *((unsigned __int16 *)a1 - 4);
        }
    else
    {
        v5 = a->size;
    }
    v6 = v5 - 8;

    // Copy old data (sized so it fits new buffer, but doesn't read beyond old
    // buffer)
    v3 = min(a2, v6);
    qmemcpy(v4, a1, v3);

    // Free the old allocation
    sub_48D9A0(a1);

    // Return the new allocation
    return v4;
}
// FIXME: This one they probably wrote themselves?!
//  a1 = input string
//  a2 = output string
//  Unescapes string, returns length of output string
int __cdecl sub_4214C0(_BYTE *a1, char *a2);

//----- (004AB5D0) --------------------------------------------------------
// Probably '_strupr', however, might not use the C locale?! (maybe POSIX
// version, `strupr`?)
LPCSTR __cdecl sub_4AB5D0(LPCSTR lpSrcStr);

//----- (0049EDD0) --------------------------------------------------------
// `_strlwr`, same caveats as with `_strupr` above.
LPCSTR __cdecl sub_49EDD0(LPCSTR lpSrcStr)
    //----- (00417010) --------------------------------------------------------
    // __get_fname

    //----- (0041C3E0) --------------------------------------------------------
    // std::locale::classic(void)

    //----- (0041E590) --------------------------------------------------------
    // std::locale::classic(void)
    //----- (0042D500) --------------------------------------------------------
    // ___setargv

    //----- (004318C0) --------------------------------------------------------
    // __RTC_NumErrors

    //----- (00445150) --------------------------------------------------------
    // __cfltcvt_init_2

    //----- (00447350) --------------------------------------------------------
    // _exit

    //----- (0044B530) --------------------------------------------------------
    // __cfltcvt_init_5

    //----- (0044B5E0) --------------------------------------------------------
    // __cfltcvt_init_6

    //----- (004804A0) --------------------------------------------------------
    // ___setargv_0

    //----- (00482E50) --------------------------------------------------------
    // j_nullsub_3

    //----- (0048C490) --------------------------------------------------------
    // timeGetTime

    //----- (0048C6A0) --------------------------------------------------------
    // _feof

    //----- (0049D390) --------------------------------------------------------
    // DirectDrawEnumerateA

    //----- (0049D396) --------------------------------------------------------
    // DirectDrawCreate

    //----- (0049D39C) --------------------------------------------------------
    // DirectInputCreateA

    //----- (0049E960) --------------------------------------------------------
    // CoUninitialize

    //----- (0049EA10) --------------------------------------------------------
    // __cinit

    //----- (0049EA40) --------------------------------------------------------
    // _exit_0

    //----- (0049EA60) --------------------------------------------------------
    // __exit

    //----- (0049EA80) --------------------------------------------------------
    // _doexit

    //----- (0049EB40) --------------------------------------------------------
    // __lockexit

    //----- (0049EB50) --------------------------------------------------------
    // __unlockexit

    //----- (0049EB60) --------------------------------------------------------
    // __initterm

    //----- (0049EB80) --------------------------------------------------------
    // _sprintf

    //----- (0049EBF0) --------------------------------------------------------
    // __fpmath

    //----- (0049EC10) --------------------------------------------------------
    // __cfltcvt_init_7

    //----- (0049EC50) --------------------------------------------------------
    // __strcmpi

    //----- (0049ED20) --------------------------------------------------------
    // __ftol

    //----- (0049ED50) --------------------------------------------------------
    // _strstr

    //----- (0049EF50) --------------------------------------------------------
    // _wcsncpy

    //----- (0049EF90) --------------------------------------------------------
    // _atof

    //----- (0049F000) --------------------------------------------------------
    // _strncmp

    //----- (0049F040) --------------------------------------------------------
    // _atol

    //----- (0049F0E0) --------------------------------------------------------
    // _atoi

    //----- (0049F0F0) --------------------------------------------------------
    // _fclose

    //----- (0049F130) --------------------------------------------------------
    // __fclose_lk

    //----- (0049F1A0) --------------------------------------------------------
    // __fsopen

    //----- (0049F1E0) --------------------------------------------------------
    // _fopen

    //----- (0049F200) --------------------------------------------------------
    // _free

    //----- (0049F270) --------------------------------------------------------
    // _malloc

    //----- (0049F290) --------------------------------------------------------
    // __nh_malloc

    //----- (0049F2E0) --------------------------------------------------------
    // __heap_alloc

    //----- (0049F340) --------------------------------------------------------
    // _strncpy

    //----- (0049F440) --------------------------------------------------------
    // __isctype

    //----- (0049F4E0) --------------------------------------------------------
    // _memcpy

    //----- (0049F820) --------------------------------------------------------
    // _rand

    //----- (0049F850) --------------------------------------------------------
    // __snprintf

    //----- (0049F8C0) --------------------------------------------------------
    // _qsort

    //----- (0049FA70) --------------------------------------------------------
    // _shortsort

    //----- (0049FAD0) --------------------------------------------------------
    // _swap

    //----- (0049FB10) --------------------------------------------------------
    // _strchr

    //----- (0049FBD0) --------------------------------------------------------
    // _ftell

    //----- (0049FC00) --------------------------------------------------------
    // __ftell_lk

    //----- (0049FDB0) --------------------------------------------------------
    // _bsearch

    //----- (0049FE50) --------------------------------------------------------
    // _tolower

    //----- (004A0020) --------------------------------------------------------
    // _fread

    //----- (004A01A0) --------------------------------------------------------
    // _fwrite

    //----- (004A02F0) --------------------------------------------------------
    // _strtok

    //----- (004A03E0) --------------------------------------------------------
    // __close

    //----- (004A0450) --------------------------------------------------------
    // __close_lk

    //----- (004A04E0) --------------------------------------------------------
    // __filelength

    //----- (004A05B0) --------------------------------------------------------
    // __sopen

    //----- (004A0950) --------------------------------------------------------
    // _fseek

    //----- (004A0990) --------------------------------------------------------
    // __fseek_lk

    //----- (004A0A30) --------------------------------------------------------
    // __alloca_probe

    //----- (004A0A60) --------------------------------------------------------
    // start

    //----- (004A0C10) --------------------------------------------------------
    // __amsg_exit

    //----- (004A0C40) --------------------------------------------------------
    // __amsg_exit_0

    //----- (004A0C66) --------------------------------------------------------
    // nullsub_4

    //----- (004A0C70) --------------------------------------------------------
    // __findfirst

    //----- (004A0DA0) --------------------------------------------------------
    // __findnext

    //----- (004A0EC0) --------------------------------------------------------
    // __findclose

    //----- (004A0EF0) --------------------------------------------------------
    // ___timet_from_ft

    //----- (004A0F80) --------------------------------------------------------
    // _strrchr

    //----- (004A0FB0) --------------------------------------------------------
    // _strncat

    //----- (004A10E0) --------------------------------------------------------
    // __vsnprintf

    //----- (004A1150) --------------------------------------------------------
    // _wcslen

    //----- (004A1170) --------------------------------------------------------
    // __snwprintf

    //----- (004A1210) --------------------------------------------------------
    // _wcsrchr

    //----- (004A1250) --------------------------------------------------------
    // _wcstok

    //----- (004A1300) --------------------------------------------------------
    // _strpbrk

    //----- (004A1340) --------------------------------------------------------
    // _strspn

    //----- (004A1380) --------------------------------------------------------
    // _realloc

    //----- (004A1530) --------------------------------------------------------
    // _fgets

    //----- (004A15C0) --------------------------------------------------------
    // _fgetws

    //----- (004A1640) --------------------------------------------------------
    // __mtinitlocks

    //----- (004A1670) --------------------------------------------------------
    // __lock

    //----- (004A16F0) --------------------------------------------------------
    // __unlock

    //----- (004A1710) --------------------------------------------------------
    // __lock_file

    //----- (004A1750) --------------------------------------------------------
    // __lock_file2

    //----- (004A1780) --------------------------------------------------------
    // __unlock_file

    //----- (004A17C0) --------------------------------------------------------
    // __unlock_file2

    //----- (004A17F0) --------------------------------------------------------
    // __flsbuf

    //----- (004A1920) --------------------------------------------------------
    // __output

    //----- (004A22B0) --------------------------------------------------------
    // _write_char

    //----- (004A2300) --------------------------------------------------------
    // _write_multi_char

    //----- (004A2340) --------------------------------------------------------
    // _write_string

    //----- (004A2380) --------------------------------------------------------
    // _get_short_arg

    //----- (004A23A0) --------------------------------------------------------
    // __setdefaultprecision

    //----- (004A23C0) --------------------------------------------------------
    // __ms_p5_test_fdiv

    //----- (004A2410) --------------------------------------------------------
    // __ms_p5_mp_test_fdiv

    //----- (004A2440) --------------------------------------------------------
    // __forcdecpt

    //----- (004A2510) --------------------------------------------------------
    // __positive

    //----- (004A2530) --------------------------------------------------------
    // __fassign

    //----- (004A2590) --------------------------------------------------------
    // __cftoe

    //----- (004A2610) --------------------------------------------------------
    // __cftoe2

    //----- (004A2710) --------------------------------------------------------
    // __cftof

    //----- (004A2780) --------------------------------------------------------
    // __cftof2

    //----- (004A2840) --------------------------------------------------------
    // __cftog

    //----- (004A2900) --------------------------------------------------------
    // __cfltcvt

    //----- (004A2970) --------------------------------------------------------
    // __shift

    //----- (004A2BD0) --------------------------------------------------------
    // __fltin2

    //----- (004A2C70) --------------------------------------------------------
    // __allmul

    //----- (004A2CB0) --------------------------------------------------------
    // __freebuf

    //----- (004A2CF0) --------------------------------------------------------
    // __fflush_lk

    //----- (004A2D30) --------------------------------------------------------
    // __flush

    //----- (004A2DA0) --------------------------------------------------------
    // __flushall

    //----- (004A2DB0) --------------------------------------------------------
    // _flsall

    //----- (004A2E70) --------------------------------------------------------
    // __openfile

    //----- (004A3040) --------------------------------------------------------
    // __getstream

    //----- (004A3120) --------------------------------------------------------
    // __heap_init

    //----- (004A3160) --------------------------------------------------------
    // ___sbh_new_region

    //----- (004A32D0) --------------------------------------------------------
    // ___sbh_release_region

    //----- (004A3330) --------------------------------------------------------
    // ___sbh_decommit_pages

    //----- (004A3400) --------------------------------------------------------
    // ___sbh_find_block

    //----- (004A3460) --------------------------------------------------------
    // ___sbh_free_block

    //----- (004A34C0) --------------------------------------------------------
    // ___sbh_alloc_block

    //----- (004A3700) --------------------------------------------------------
    // ___sbh_alloc_block_from_page

    //----- (004A3880) --------------------------------------------------------
    // ___sbh_resize_block

    //----- (004A3950) --------------------------------------------------------
    // __callnewh

    //----- (004A3970) --------------------------------------------------------
    // ___crtGetStringTypeW

    //----- (004A3C40) --------------------------------------------------------
    // __mtinit

    //----- (004A3CA0) --------------------------------------------------------
    // __initptd

    //----- (004A3CC0) --------------------------------------------------------
    // __getptd

    //----- (004A3D40) --------------------------------------------------------
    // __dosmaperr

    //----- (004A3DC0) --------------------------------------------------------
    // __errno

    //----- (004A3DD0) --------------------------------------------------------
    // ___doserrno

    //----- (004A3DE0) --------------------------------------------------------
    // __ioinit

    //----- (004A3FF0) --------------------------------------------------------
    // __lseek

    //----- (004A4070) --------------------------------------------------------
    // __lseek_lk

    //----- (004A40F0) --------------------------------------------------------
    // __filbuf

    //----- (004A41E0) --------------------------------------------------------
    // __read

    //----- (004A4260) --------------------------------------------------------
    // __read_lk

    //----- (004A4490) --------------------------------------------------------
    // __write

    //----- (004A4510) --------------------------------------------------------
    // __write_lk

    //----- (004A4720) --------------------------------------------------------
    // __alloc_osfhnd

    //----- (004A4890) --------------------------------------------------------
    // __set_osfhnd

    //----- (004A4940) --------------------------------------------------------
    // __free_osfhnd

    //----- (004A49E0) --------------------------------------------------------
    // __get_osfhandle

    //----- (004A4A30) --------------------------------------------------------
    // __lock_fhandle

    //----- (004A4AA0) --------------------------------------------------------
    // __unlock_fhandle

    //----- (004A4AD0) --------------------------------------------------------
    // __chsize_lk

    //----- (004A4C20) --------------------------------------------------------
    // __XcptFilter

    //----- (004A4E30) --------------------------------------------------------
    // _xcptlookup

    //----- (004A4E70) --------------------------------------------------------
    // __ismbblead

    //----- (004A4E90) --------------------------------------------------------
    // _x_ismbbtype

    //----- (004A4ED0) --------------------------------------------------------
    // __setenvp

    //----- (004A4FC0) --------------------------------------------------------
    // __setargv

    //----- (004A5060) --------------------------------------------------------
    // _parse_cmdline

    //----- (004A5270) --------------------------------------------------------
    // ___crtGetEnvironmentStringsA

    //----- (004A5600) --------------------------------------------------------
    // _getSystemCP

    //----- (004A5650) --------------------------------------------------------
    // _CPtoLCID

    //----- (004A56B0) --------------------------------------------------------
    // _setSBCS

    //----- (004A58D0) --------------------------------------------------------
    // ___initmbctable

    //----- (004A58E0) --------------------------------------------------------
    // __global_unwind2

    //----- (004A5900) --------------------------------------------------------
    // __unwind_handler

    //----- (004A5922) --------------------------------------------------------
    // __local_unwind2

    //----- (004A598A) --------------------------------------------------------
    // __abnormal_termination

    //----- (004A59AC) --------------------------------------------------------
    // _at_done

    //----- (004A59AD) --------------------------------------------------------
    // __NLG_Notify1

    //----- (004A59B6) --------------------------------------------------------
    // __NLG_Notify

    //----- (004A59D8) --------------------------------------------------------
    // __except_handler3

    //----- (004A5A95) --------------------------------------------------------
    // _seh_longjmp_unwind(x)

    //----- (004A5AB0) --------------------------------------------------------
    // __FF_MSGBANNER

    //----- (004A5AF0) --------------------------------------------------------
    // __NMSG_WRITE

    //----- (004A5CD0) --------------------------------------------------------
    // ___loctotime_t

    //----- (004A5DC0) --------------------------------------------------------
    // __woutput

    //----- (004A6720) --------------------------------------------------------
    // _write_char_0

    //----- (004A6750) --------------------------------------------------------
    // _write_multi_char_0

    //----- (004A6790) --------------------------------------------------------
    // _write_string_0

    //----- (004A67D0) --------------------------------------------------------
    // _get_int_arg

    //----- (004A67F0) --------------------------------------------------------
    // _get_int64_arg

    //----- (004A6810) --------------------------------------------------------
    // __getwc_lk

    //----- (004A6A10) --------------------------------------------------------
    // __getbuf

    //----- (004A6A70) --------------------------------------------------------
    // __isatty

    //----- (004A6AA0) --------------------------------------------------------
    // _wctomb

    //----- (004A6B10) --------------------------------------------------------
    // __wctomb_lk

    //----- (004A6B90) --------------------------------------------------------
    // __aulldiv

    //----- (004A6C00) --------------------------------------------------------
    // __aullrem

    //----- (004A6C80) --------------------------------------------------------
    // __control87

    //----- (004A6CC0) --------------------------------------------------------
    // __controlfp

    //----- (004A6CE0) --------------------------------------------------------
    // __abstract_cw

    //----- (004A6D80) --------------------------------------------------------
    // __hw_cw

    //----- (004A6E10) --------------------------------------------------------
    // __ZeroTail

    //----- (004A6E80) --------------------------------------------------------
    // __IncMan

    //----- (004A6EF0) --------------------------------------------------------
    // __RoundMan

    //----- (004A6F90) --------------------------------------------------------
    // __CopyMan

    //----- (004A6FB0) --------------------------------------------------------
    // __FillZeroMan

    //----- (004A6FC0) --------------------------------------------------------
    // __IsZeroMan

    //----- (004A6FE0) --------------------------------------------------------
    // __ShrMan

    //----- (004A70A0) --------------------------------------------------------
    // __ld12cvt

    //----- (004A7330) --------------------------------------------------------
    // __fptostr

    //----- (004A73D0) --------------------------------------------------------
    // __fltout2

    //----- (004A7460) --------------------------------------------------------
    // ___dtold

    //----- (004A7520) --------------------------------------------------------
    // __fptrap

    //----- (004A7530) --------------------------------------------------------
    // ___init_time

    //----- (004A75E0) --------------------------------------------------------
    // __get_lc_time

    //----- (004A7960) --------------------------------------------------------
    // __free_lc_time

    //----- (004A7BA0) --------------------------------------------------------
    // _storeTimeFmt

    //----- (004A7CA0) --------------------------------------------------------
    // ___init_numeric

    //----- (004A7EA0) --------------------------------------------------------
    // ___init_monetary

    //----- (004A7F90) --------------------------------------------------------
    // __get_lc_lconv

    //----- (004A80E0) --------------------------------------------------------
    // _fix_grouping

    //----- (004A8120) --------------------------------------------------------
    // __free_lc_lconv

    //----- (004A8450) --------------------------------------------------------
    // _strcspn

    //----- (004A8490) --------------------------------------------------------
    // ___strgtold12

    //----- (004A8C20) --------------------------------------------------------
    // __commit

    //----- (004A8CC0) --------------------------------------------------------
    // _calloc

    //----- (004A8D70) --------------------------------------------------------
    // __setmode_lk

    //----- (004A8DE0) --------------------------------------------------------
    // ___crtMessageBoxA

    //----- (004A8E70) --------------------------------------------------------
    // ___tzset

    //----- (004A8EB0) --------------------------------------------------------
    // __tzset_lk

    //----- (004A9190) --------------------------------------------------------
    // __isindst

    //----- (004A9430) --------------------------------------------------------
    // _cvtdate

    //----- (004A95D0) --------------------------------------------------------
    // _mbtowc

    //----- (004A9650) --------------------------------------------------------
    // __mbtowc_lk

    //----- (004A9750) --------------------------------------------------------
    // __putwc_lk

    //----- (004A98C0) --------------------------------------------------------
    // __filwbuf

    //----- (004A99C0) --------------------------------------------------------
    // _ungetc

    //----- (004A99F0) --------------------------------------------------------
    // _ungetc_0

    //----- (004A9A80) --------------------------------------------------------
    // __allshl

    //----- (004A9AA0) --------------------------------------------------------
    // __fcloseall

    //----- (004A9B40) --------------------------------------------------------
    // ___addl

    //----- (004A9B70) --------------------------------------------------------
    // ___add_12

    //----- (004A9BE0) --------------------------------------------------------
    // ___shl_12

    //----- (004A9C10) --------------------------------------------------------
    // ___shr_12

    //----- (004A9C40) --------------------------------------------------------
    // ___mtold12

    //----- (004A9D40) --------------------------------------------------------
    // _$I10_OUTPUT

    //----- (004AA0D0) --------------------------------------------------------
    // ___getlocaleinfo

    //----- (004AA280) --------------------------------------------------------
    // __strnicmp

    //----- (004AA390) --------------------------------------------------------
    // ___ld12mul

    //----- (004AA650) --------------------------------------------------------
    // ___multtenpow12

    //----- (004AA6E0) --------------------------------------------------------
    // _wcstombs

    //----- (004AA760) --------------------------------------------------------
    // __wcstombs_lk

    //----- (004AA950) --------------------------------------------------------
    // _wcsncnt

    //----- (004AA990) --------------------------------------------------------
    // __getenv_lk

    //----- (004AAA20) --------------------------------------------------------
    // __flswbuf

    //----- (004AAB70) --------------------------------------------------------
    // ___crtGetLocaleInfoW

    //----- (004AADE0) --------------------------------------------------------
    // __mbsnbicoll

    //----- (004AAE20) --------------------------------------------------------
    // ___wtomb_environ

    //----- (004AAEA0) --------------------------------------------------------
    // ___crtCompareStringA

    //----- (004AB170) --------------------------------------------------------
    // _strncnt

    //----- (004AB1A0) --------------------------------------------------------
    // ___crtsetenv

    //----- (004AB3B0) --------------------------------------------------------
    // _findenv

    //----- (004AB430) --------------------------------------------------------
    // _copy_environ

    //----- (004AB4A0) --------------------------------------------------------
    // __mbschr

    //----- (004AB570) --------------------------------------------------------
    // __strdup

    //----- (004AB5C0) --------------------------------------------------------
    // RtlUnwind
    //----- (004AC054) --------------------------------------------------------
    // 4AC054: using guessed type int __stdcall IFReleaseProject(_DWORD);
    //----- (004AC058) --------------------------------------------------------
    // 4AC058: using guessed type int __stdcall IFReleaseEffects(_DWORD,
    // _DWORD);
    //----- (004AC05C) --------------------------------------------------------
    // 4AC05C: using guessed type int __stdcall IFCreateEffects(_DWORD, _DWORD,
    // _DWORD);
    //----- (004AC060) --------------------------------------------------------
    // 4AC060: using guessed type int __stdcall IFLoadProjectFile(_DWORD,
    // _DWORD);
    //----- (004AC1BC) --------------------------------------------------------
    // 4AC1BC: using guessed type int __cdecl SmushSetVolume(_DWORD);
    //----- (004AC1C0) --------------------------------------------------------
    // 4AC1C0: using guessed type int __cdecl SmushPlay(_DWORD, _DWORD, _DWORD,
    // _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD, _DWORD,
    // _DWORD);
    //----- (004AC1C4) --------------------------------------------------------
    // 4AC1C4: using guessed type int SmushShutdown(void);
    //----- (004AC1C8) --------------------------------------------------------
    // 4AC1C8: using guessed type int __cdecl SmushStartup(_DWORD, _DWORD);
    //----- (0049FFE0) --------------------------------------------------------
    size_t __cdecl fread_locked(void *a1, size_t a2, size_t a3, FILE *a4)
{
    size_t v4; // edi

    _lock_file(a4);
    v4 = fread(a1, a2, a3, a4); // actually _fread_nolock() probably
    _unlock_file(a4);
    return v4;
}

//----- (004A0160) --------------------------------------------------------
size_t __cdecl fwrite_locked(void *a1, size_t a2, size_t a3, FILE *a4)
{
    size_t v4; // edi

    _lock_file(a4);
    v4 = fwrite(a1, a2, a3, a4); // actually _fwrite_nolock() probably
    _unlock_file(a4);
    return v4;
}
